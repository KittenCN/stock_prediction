# Hybrid ??/???????2025-10-21?

?????? Hybrid ????????????????????????????????????????

## 1. ????
- ?? `python scripts/train.py --mode test --model hybrid --full_train 1` ???`png/test/000019_HYBRID_test_close_*.csv` ? RMSE?1.44?MAPE?3.97%??????????????
- ?? `python scripts/train.py --mode predict --model hybrid --test_code 000019 --full_train 1` ???`png/predict/000019_HYBRID_predict_close_*.csv` ?????? 139.50 ??????
- ???????????? `[WARN] No symbol-specific normalization stats found for 000019; using global statistics.`???????????????

## 2. ????
1. ??????????????????  
   ????? `Stock_Data.normalize_data()` ?????????? `saved_mean_list/saved_std_list`????? `mean_list/std_list`????????????????? `*_norm_params*.json` ???????????/???
2. ????????????????  
   `test()`?`predict()` ?????????? `mean_list/std_list`????? `ts_code` ???????? 000019 ?????????? 139.50 ????
3. ???????? per-symbol ??  
   ?? `scripts/verify_normalization.py` ??????/??????????? `*_norm_params*.json` ?? per-symbol ????????????

## 3. ????
1. ??????????????  
   - ? `Stock_Data`?`stock_queue_dataset` ??? `norm_symbol` ?????????????? 6 ? `ts_code`?? `000019`????? `symbol_norm_map`?  
   - ?????????????????????PKL ?????????? `symbol_norm_map` ???????
2. ?????? per_symbol ??  
   - `save_model()` ??? `*_norm_params*.json` ?? `version=2` ? `per_symbol` ??????
     {
       "version": 2,
       "mean_list": [...],
       "std_list": [...],
       "per_symbol": {
         "000019": { "mean_list": [...], "std_list": [...] },
         "...": { "mean_list": [...], "std_list": [...] }
       }
     }
   - ??????????? `per_symbol` ??????????????
3. ????? ts_code ??????  
   - ? `train.py/test()` ? `predict.py` ??? `_apply_norm_from_params()`??? `ts_code` ????????/?????????????????? 1e-3??? `Normalization mismatch` ???
   - `predict.py` ? `_init_models()` ??? CLI ?????? `--test_code` ????? per-symbol ???
4. ??????  
   - `scripts/verify_normalization.py` ?? `--ts_code/--stock_code` ? `--norm_file` ????????/??????????? norm ???? per-symbol ??????????

## 4. ???????
1. ???
   - `python scripts/train.py --mode train --model hybrid --epoch 30 --full_train 1`
   - ??????`models/GenericData/HYBRID/HYBRID_out4_time5_norm_params.json` ???? `per_symbol.000019`?
2. ???
   - `python scripts/train.py --mode predict --model hybrid --test_code 000019 --full_train 1`
   - ????? `Using symbol-specific norm stats for 000019`??? CSV ???? 139.50 ????
3. ???
   - `python scripts/verify_normalization.py --ts_code 000019 --norm_file models/GenericData/HYBRID/HYBRID_out4_time5_norm_params.json`
   - ????? `Verification passed`???????????????????

## 5. ????
- ??????????????????? `*_norm_params*.json`?? `stock_daily/*.csv` ??????? `per_symbol` ????????????
- ? CLI ???????????????????????????????????
- ???????????????? `_apply_norm_from_params()` ???????????????

## 6. 2025-10-22 ??
- ? png/test ? png/predict ??? CSV ???? std_ratio?bias?????????????????? VS Code ???????
- ? train.py ? predict.py ??? distribution_report?? std_ratio < 0.8 ? |bias| > 0.5 ??? WARN ?????
- ???? `scripts/analyze_predictions.py`??????? CSV ?????????????
- ?? HybridLoss ??????mean_weight=0.05?return_weight=0.08?volatility_weight=0.12????????????
- ? CI ????? `make diagnose` ??????????? `analyze_predictions.py` ??????
